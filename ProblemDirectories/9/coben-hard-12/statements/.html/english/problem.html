<HTML><HEAD><META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <META content="no-cache" http-equiv="pragma">
    <META content="-1" http-equiv="expires">
    <META content="text/html;charset=UTF-8" http-equiv="content-type">
    <LINK href="problem-statement.css" rel="stylesheet" type="text/css">
    <TITLE>C.O.B.E.N (Hard Version)</TITLE>
    <SCRIPT type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$$$','$$$']], displayMath: [['$$$$$$','$$$$$$']]}
        });
        </SCRIPT>
        <SCRIPT async="" src="https://polygon.codeforces.com/lib/MathJax/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
    </SCRIPT>
</HEAD><BODY>
    <DIV class="problem-statement"><DIV class="header"><DIV class="title">C.O.B.E.N (Hard Version)</DIV><DIV class="time-limit"><DIV class="property-title">time limit per test</DIV>10 seconds</DIV><DIV class="memory-limit"><DIV class="property-title">memory limit per test</DIV>512 megabytes</DIV><DIV class="input-file input-standard"><DIV class="property-title">input</DIV>standard input</DIV><DIV class="output-file output-standard"><DIV class="property-title">output</DIV>standard output</DIV></DIV><DIV class="legend"><P><SPAN class="tex-font-style-bf">This is the hard version of the problem. The only difference between the two versions is the time limit, constraints on $$$n$$$, and that ties are permitted. You can make hacks only if both versions of the problem are solved.</SPAN></P><P><SPAN class="tex-font-style-bf">Amog</SPAN> the Mogger enters the <SPAN class="tex-font-style-bf">Moniforces</SPAN> into a multiplayer Nim tournament. However, they don't know the optimal strategy and thus play no better than random. </P><P>You are given $$$n$$$ players with their current scores $$$p_1, p_2, \ldots, p_n$$$ and $$$n$$$ non-negative bonuses $$$s_1, s_2, \ldots, s_n$$$. In the next round, each player will randomly receive one of the bonuses. The player with the lowest total score after the round will be eliminated. <SPAN class="tex-font-style-bf">In the event of a tie for the lowest total score among $$$k$$$ players, one of them is eliminated uniformly at random, with each having a probability of $$$\frac{1}{k}$$$.</SPAN></P><P>Your task is to calculate, for each player $$$i$$$, the exact probability of being eliminated after the next round, returned modulo $$$998244353$$$.</P></DIV><P></P><P></P><DIV class="input-specification"><DIV class="section-title">Input</DIV><P></P><P>The first line contains $$$t \; (1 \leqslant t \leqslant 20)$$$, the number of test cases.</P><P>Then, $$$t$$$ test cases follow and for each test case:</P><P>The first line contains one integer, $$$n \, (1 \leqslant n \leqslant \bf{150})$$$</P><P>The second line contains $$$n$$$ space separated integers, where $$$p_i \, (0 \leqslant p_i \leqslant 10^9)$$$ represents the current score of player $$$i$$$.</P><P>The third line contains $$$n$$$ space separated integers, where $$$s_i \, (0 \leqslant s_i \leqslant 10^9)$$$ represents the score bonus associated with $$$i^{\text{th}}$$$ place.</P><P>It is guaranteed that the sum of $$$n$$$ over all test cases will not exceed $$$\bf{150}$$$.</P></DIV><P></P><P></P><DIV class="output-specification"><DIV class="section-title">Output</DIV><P></P><P>A single line containing $$$n$$$ integers, space separated, where the $$$i^{\text{th}}$$$ integer represents the probability $$$\text{mod } 998244353$$$ that player $$$i$$$ is eliminated.</P><P>It can be shown that the expected value has the form $$$\frac{P}{Q}$$$, where $$$P$$$ and $$$Q$$$ are non-negative coprime integers, and $$$Q \neq 0$$$. Report the value of $$$P \cdot Q^{-1} \pmod{998244353}$$$.</P></DIV><P></P><P></P><DIV class="sample-tests"><DIV class="section-title">Example</DIV><P></P><P></P><DIV class="sample-test"><DIV class="input"><DIV class="title">Input</DIV><PRE class="content" data-content="3
3
60 40 20
100 50 25
6
7495 4929 5117 6657 5763 7521
5767 4037 2833 2307 1730 1442
2
3 4
5 4
">
<DIV class="test-example-line test-example-line-even test-example-line-0">3</DIV><DIV class="test-example-line test-example-line-even test-example-line-0">3</DIV><DIV class="test-example-line test-example-line-even test-example-line-0">60 40 20</DIV><DIV class="test-example-line test-example-line-even test-example-line-0">100 50 25</DIV><DIV class="test-example-line test-example-line-even test-example-line-0">6</DIV><DIV class="test-example-line test-example-line-even test-example-line-0">7495 4929 5117 6657 5763 7521</DIV><DIV class="test-example-line test-example-line-even test-example-line-0">5767 4037 2833 2307 1730 1442</DIV><DIV class="test-example-line test-example-line-even test-example-line-0">2</DIV><DIV class="test-example-line test-example-line-even test-example-line-0">3 4</DIV><DIV class="test-example-line test-example-line-even test-example-line-0">5 4</DIV></PRE></DIV><DIV class="output"><DIV class="title">Output</DIV><PRE class="content">
166374059 332748118 499122177 
0 58230921 58230921 144190851 737591661 0 
249561089 748683265 
</PRE></DIV></DIV></DIV><P></P><P></P><DIV class="note"><DIV class="section-title">Note</DIV><P></P><P>We have 3 players with current scores $$$p = [60, 40, 20]$$$ and bonus options $$$s = [100, 50, 25]$$$. There are $$$3! = 6$$$ ways to assign the 3 bonuses, and in each assignment, the player with the lowest total $$$(p_i + s_{\pi(i)})$$$ is eliminated. Enumerating: </P><P>1. $$$[160,90,45] \to $$$ Player 3 is eliminated. </P><P> 2. $$$[160,65,70] \to $$$ Player 2 is eliminated. </P><P>3. $$$[110,140,45] \to $$$ Player 3 is eliminated. </P><P>4. $$$[110,65,120] \to $$$ Player 2 is eliminated. </P><P>5. $$$[85,140,45] \to $$$ Player 3 is eliminated. </P><P>6. $$$[85,90,120] \to $$$ Player 1 is eliminated. </P><P><SPAN class="tex-font-style-bf">Player 1</SPAN> is eliminated in 1 of 6 permutations $$$(\frac{1}{6})$$$. </P><P> <SPAN class="tex-font-style-bf">Player 2</SPAN> is eliminated in 2 of 6 permutations $$$(\frac{1}{3})$$$. </P><P><SPAN class="tex-font-style-bf">Player 3</SPAN> is eliminated in 3 of 6 permutations $$$(\frac{1}{2})$$$.</P><P>A tie is possible for the last test case; if we allocate the score bonus $$$5$$$ to player 1 and the score bonus $$$4$$$ to player 2, both end with a total score of $$$8$$$. Therefore, we begin the procedure and uniformly pick one of them at random, which means they each have a $$$\frac{1}{2}$$$ chance of being eliminated if those score bonuses are allocated in that manner. The probabilities of elimination over all permutations are $$$\frac{3}{4}$$$ for player 1 and $$$\frac{1}{4}$$$ for player 2.</P></DIV></DIV><P></P><P>  </P>

</BODY></HTML>